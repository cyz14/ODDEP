//- ToDo: 添加跳转到VHDL编辑器界面按钮，或支持多tab浏览
//- ToDo: 解决加载完js文件之前的界面混乱问题
doctype html
head 
  title Visual Editor
  block addstylesheets
    //- toolbar button ui 
    link(rel="stylesheet", href="/lib/aristo/jquery-ui-1.8.16.custom.css")
    //- jquery layout library
    link(rel="stylesheet", href="/lib/jquery.layout.css")
    link(rel="stylesheet", href="/stylesheets/visual-editor.css")

body#container
  //- navigation bar, has bug here. Layout should be controlled in Application.js by jquery layout library.
  //- include includes/navbar
  div#navigation
    div.palette_node_element.draw2d_droppable(data-shape="draw2d_circuit_switch_HighLow") Switch
    div.palette_node_element.draw2d_droppable(data-shape="draw2d_circuit_display_Led") Led
    div.palette_node_element.draw2d_droppable(data-shape="draw2d.shape.node.Between") 74LS00
    div.palette_node_element.draw2d_droppable(data-shape="draw2d.shape.node.Between") 74LS04
    div.palette_node_element.draw2d_droppable(data-shape="draw2d.shape.node.Between") 74LS86
    //- ToDO: 添加跳转Button to VHDL editor
    div#VHDL
      button.btn.btn-lg.btn-link(type="button")
        a(href="/vhdl", onclick="") VHDL

  div#content
    div#toolbar
      div#radio
        input#radio1(type="radio", name="radio", data-router="draw2d.layout.connection.ManhattanConnectionRouter", checked="checked")
        label(for="radio1") Manhattan
        input#radio2(type="radio", name="radio", data-router="draw2d.layout.connection.ManhattanBridgedConnectionRouter")
        label(for="radio2") Manhattan Bridged
        input#radio3(type="radio", name="radio", data-router="draw2d.layout.connection.InteractiveManhattanConnectionRouter")
        label(for="radio3") Interactive Manhattan
        input#radio4(type="radio", name="radio", data-router="draw2d.layout.connection.CircuitConnectionRouter")
        label(for="radio4") Circuit

    div#canvasWrapper
      div#canvas(style="width:6000px; height:6000px;")
      //- ToDo: add zoom_in and zoom_out and zoom_normal functions
      div#canvas_zoom.btn-group
        button(type="button")#canvas_zoom_in.btn.highlight -
        button(type="button")#canvas_zoom_normal.btn.highlight 100%
        button(type="button")#canvas_zoom_out.btn.highlight +
    div#json
    block addscript
      //- draw2d library dependencies 
      include includes/draw2d_js

      //- draw2d Classes for the GUI editor application
      script(src="/javascripts/draw2d/Application.js")
      script(src="/javascripts/draw2d/Palette.js")
      script(src="/javascripts/draw2d/View.js")
      script(src="/javascripts/draw2d/Toolbar.js")

      script(src="/javascripts/draw2d/figures/example.json")
      //- ToDo: load draw2d buildin shapes of Circuit. Already support Switch and Led.
      script(src="/javascripts/draw2d/circuit/test.circuit")

      //- 为了显示右下角的zoom button需要把json显示栏隐藏
      script.
        var showJSON = true;
        $(window).load( function(){
          var app = new tot.Application();
          app.load(jsonDocument);
          app.load(testCircuit);
          if (showJSON === true) {
            displayJSON(app.view);
            // add an event listener to the Canvas for change notifications.
            // We just dump the current canvas document into the DIV
            //
            app.view.getCommandStack().addEventListener(
              function(e){
                if(e.isPostChangeEvent()){
                    displayJSON(app.view);
              }
            });
          }
        });
        function displayJSON(canvas){
          var writer = new draw2d.io.json.Writer();
          writer.marshal(canvas, function(json){
              $("#json").html("<pre>"+JSON.stringify(json,null,2)+"<pre>");
          });
        }
